<?xml version="1.0" encoding="utf-8"?>
<Project>
    <ItemGroup>
        <Compile Include="@(Slice->'$(SliceOutputDir)/$(TargetFramework)/%(Filename).cs')" />
    </ItemGroup>
    <Target Name="SliceCompile" BeforeTargets="CoreCompile"
            Inputs="@(Slice);$(SliceCompiler)"
            Outputs="$(SliceOutputDir)/$(TargetFramework)/SliceCompiler.command.log"
            Condition="@(Slice) != ''">
        <Error Text="Unable to locate Slice to CSharp compiler SliceCompiler=$(SliceCompiler)" Condition="!Exists('$(SliceCompiler)')" />
        <MakeDir Directories="$(SliceOutputDir)/$(TargetFramework)"/>
        <Exec Command="$(SliceCompiler) --output-dir $(SliceOutputDir)/$(TargetFramework) -I$(IceHome)/slice $(SliceCompilerArgs) @(Slice->'%(Identity)', ' ')" />
        <WriteLinesToFile File="$(SliceOutputDir)/$(TargetFramework)/SliceCompiler.command.log"
                          Lines="Ice Home: $(IceHome);Output Dir: $(SliceOuputDir)/$(TargetFramework);Slice Compiler Args: $(SliceCompilerArgs)"
                          Overwrite="true" />
    </Target>

    <Target Name="SliceClean" BeforeTargets="Clean">
        <Delete Files="@(Slice->'$(SliceOutputDir)/$(TargetFramework)/%(Filename).cs')" />
        <Delete Files="$(SliceOutputDir)/$(TargetFramework)/SliceCompiler.command.log" />
    </Target>

</Project>
