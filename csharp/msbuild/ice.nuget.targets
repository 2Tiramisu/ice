<Project DefaultTargets="NugetPack" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
    <PropertyGroup>
        <IceSrcRootDir>$(MSBuildThisFileDirectory)..\</IceSrcRootDir>
    </PropertyGroup>

    <!-- For CSharp we use Slice compiler from x64 Release builds -->
    <ItemGroup>
        <SliceCompilers Include="$(IceSrcRootDir)..\cpp\bin\x64\Release\slice2cs.exe;
                                 $(IceSrcRootDir)..\cpp\bin\x64\Release\slice2html.exe" />

        <!-- With .Net Core we have to pack the dependencies next iceboxnet.dll  -->
        <IceBoxNet Include="$(IceSrcRootDir)bin\**\iceboxnet.exe;
                            $(IceSrcRootDir)bin\**\iceboxnet.dll;
                            $(IceSrcRootDir)bin\**\iceboxnet.pdb;
                            $(IceSrcRootDir)bin\**\iceboxnet.deps.json;
                            $(IceSrcRootDir)bin\**\Ice.dll;
                            $(IceSrcRootDir)bin\**\Ice.pdb;
                            $(IceSrcRootDir)bin\**\IceBox.dll;
                            $(IceSrcRootDir)bin\**\IceBox.pdb"/>

        <Assemblies Include="$(IceSrcRootDir)lib\**\*.dll;
                             $(IceSrcRootDir)lib\**\*.pdb;
                             $(IceSrcRootDir)lib\**\*.xml"/>

        <Slices Include="$(IceSrcRootDir)..\slice\**\*.ice"
                Exclude="$(IceSrcRootDir)..\slice\IceDiscovery\*.ice;
                         $(IceSrcRootDir)..\slice\IceLocatorDiscovery\*.ice"/>
    </ItemGroup>

    <!-- Copy required files to the package specific directories -->
    <Target Name="NugetPack">
        <Copy SourceFiles="@(Assemblies)" DestinationFolder="$(PackageDirectory)\lib\%(Assemblies.RecursiveDir)"/>
        <Copy SourceFiles="@(Slices)" DestinationFolder="$(PackageDirectory)\slice\%(Slices.RecursiveDir)"/>
        <Copy SourceFiles="@(SliceCompilers)" DestinationFolder="$(PackageDirectory)\tools"/>
        <Copy SourceFiles="@(IceBoxNet)" DestinationFolder="$(PackageDirectory)\tools\%(IceBoxNet.RecursiveDir)"/>
    </Target>
</Project>
